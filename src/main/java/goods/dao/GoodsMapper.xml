<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

	
<mapper namespace="goodsSQL">
	<select id="getGoodsList" parameterType="int" resultType="goods.bean.GoodsDTO">
		select * from goods
	</select>
	
	<select id="getGoodsDetail" parameterType="int" resultType="goods.bean.GoodsDTO">
		select * from goods where goods_id=#{goodsId}
	</select>
	
	<select id="getCategory" parameterType="int" resultType="goods.bean.GoodsDTO">
		select * from category join goods
		on category.category_code = goods.category_code
		where category.category_code= #{category}
	</select>
	
	<select id="goods_lineUp" parameterType="String" resultType="goods.bean.GoodsDTO">
		select * from goods order by
		<if test="lineUp == 'newly'">
			goods_date
		</if>
		<if test="lineUp == 'popular'">
			goods_cum_sales desc
		</if>
		<if test="lineUp == 'hight_price'">
			goods_price desc
		</if>
		<if test="lineUp == 'low_price'">
			goods_price
		</if>
	</select>
	
	<!-- 상품문의 -->
	<insert id="qnaWrite" parameterType="java.util.Map">
		insert into goods_board(bo_seq, email, goods_id, category_code, title, text_content, board_date)
		values(goods_board_bo_seq.nextval, 'dogiver503@gmail.com', #{goods_id}, 'QNA', 'test', #{text_content}, SYSDATE)
	</insert>
	
	<select id="getGoodsQnaList" parameterType="int" resultType="goods.bean.QnaDTO">
		select * from goods_board where goods_id=#{goods_id} AND category_code='QNA' order by board_date desc
	</select>
	
 	<insert id="writeReply" parameterType="java.util.Map"> 
		insert into goods_board(email, goods_id, category_code, title, reply, board_date, bo_seq, re_seq)
		values('dogiver503@gmail.com', #{goods_id}, 'QNA', 'test', #{reply}, SYSDATE, #{bo_seq}, goods_board_bo_seq.nextval)
	</insert>
	
	<select id="replyList" parameterType="int" resultType="goods.bean.QnaDTO">
		select * from goods_board WHERE bo_seq=#{bo_seq} AND reply IS NOT NULL
	</select>
	
	<!-- 상품리뷰 -->
 	<insert id="reviewWrite" parameterType="goods.bean.QnaDTO">
		insert into goods_board(email, goods_id, category_code, title, text_content, image, board_date, bo_seq)
		values(#{email}, #{goods_id}, 'REVIEW', 'test', #{text_content}, #{image}, SYSDATE, goods_board_bo_seq.nextval) 
	</insert> 
	
	<select id="getGoodsReviewList" parameterType="int" resultType="goods.bean.QnaDTO">
		SELECT * 
		  FROM goods_board
               JOIN member
		       ON member.email = goods_board.email
		 WHERE goods_board.goods_id=#{goods_id}
		       AND category_code='REVIEW' ORDER BY board_date DESC
	</select>
	
	<select id="reviewView" parameterType="int" resultType="goods.bean.QnaDTO">
		select * from goods_board where bo_seq=#{bo_seq} AND category_code='REVIEW'
	</select>
	
	<select id="reviewUpdateWin" parameterType="int" resultType="goods.bean.QnaDTO">
		select * from goods_board where bo_seq=#{bo_seq} AND category_code='REVIEW'
	</select>
	
	<insert id="reviewUpdate" parameterType="goods.bean.QnaDTO">
		update goods_board set text_content=#{text_content}, image=#{image} where bo_seq=#{bo_seq} 
	</insert>
	
	<delete id="reviewDelete" parameterType="int">
		delete from goods_board where bo_seq=#{bo_seq}
	</delete>
</mapper>
